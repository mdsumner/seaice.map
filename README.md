
<!-- README.md is generated from README.Rmd. Please edit that file -->

# seaice.map

<!-- badges: start -->
<!-- [![R-CMD-check](https://github.com/mdsumner/seaice.map/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/mdsumner/seaice.map/actions/workflows/R-CMD-check.yaml)-->
<!-- badges: end -->

The goal of seaice.map is to

- download very latest available sea ice concentration data
- generate a global map of the data with a customizable focus
  (i.e. global but centred on Tasmania/East Antarctica)
- also show some contextual spatio-temporal data (i.e. recent movements
  of a research vessel)
- explicate how to do this all with free tools.

``` r
library(terra)
#> terra 1.7.46
r <- rast("data-raw/seaice.png")
plotRGB(r, axes = F, maxcell = prod(dim(r)[2:1]))

points(terra::project(do.call(cbind, maps::map(plot = F)[1:2]), to = terra::crs(r), from = "OGC:CRS84"), pch = ".", col = "#777777")
title(readLines("data-raw/latestdate.txt"), line = -2, col.main = "white")
```

<img src="man/figures/README-example-1.png" width="100%" />

``` r


#aadcgeoserver <- "WFS:https://data.aad.gov.au/geoserver/ows?service=wfs&version=2.0.0&request=GetCapabilities"
#layer <- "underway:nuyina_underway"
#info <- vapour::vapour_layer_info(aadcgeoserver, "underway:nuyina_underway")
#n <- 12 * 24 * 60
#sql <- sprintf("SELECT * FROM \"%s\" LIMIT %i OFFSET %i", layer, n, info$count - n)
#dat <- vapour::vapour_read_fields(aadcgeoserver, sql = sql)


#info <- vapour::vapour_layer_info("data-raw/nuyina_underway.parquet")
n <- 12 * 24 * 60
#sql <- sprintf("SELECT * FROM \"%s\" LIMIT %i OFFSET %i", info$layer_names[1], n, info$count - n)

#dat <- vapour::vapour_read_fields("data-raw/nuyina_underway.parquet", sql = sql)

dat <- arrow::read_parquet("data-raw/nuyina_underway.parquet")


print(str(dat))
#> Classes 'tbl_df', 'tbl' and 'data.frame':    301252 obs. of  62 variables:
#>  $ gml_id                                                       : chr  "nuyina_underway.2021-12-23 05:00:00+00" "nuyina_underway.2021-12-23 05:01:00+00" "nuyina_underway.2021-12-23 05:02:00+00" "nuyina_underway.2021-12-23 05:03:00+00" ...
#>  $ set_code                                                     : chr  "202122020" "202122020" "202122020" "202122020" ...
#>  $ date_time_utc                                                : chr  "2021/12/23 05:00:00+00" "2021/12/23 05:01:00+00" "2021/12/23 05:02:00+00" "2021/12/23 05:03:00+00" ...
#>  $ latitude                                                     : num  -42.9 -42.9 -42.9 -43 -43 ...
#>  $ longitude                                                    : num  147 147 147 147 147 ...
#>  $ shipnav_heave                                                : num  -0.05 -0.02 0.04 -0.06 -0.02 0.02 -0.01 0.01 0.01 0 ...
#>  $ shipnav_pitch                                                : num  0.12 0.11 0.03 0.11 0.08 0.03 0.04 0.05 0.01 -0.05 ...
#>  $ shipnav_roll                                                 : num  0.4 0.34 0.36 0.37 0.21 0.21 0.26 0.2 0.28 0.23 ...
#>  $ shipnav_ground_course                                        : num  184 182 180 177 180 ...
#>  $ air_pressure                                                 : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ air_pressure_tend3h                                          : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ air_pressure_trend3h                                         : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_wind_direction_avg10m                                   : num  65 66 68 69 70 71 72 73 75 77 ...
#>  $ fore_wind_from_direction_relative                            : num  270 276 284 287 284 283 274 282 297 270 ...
#>  $ fore_wind_from_direction_true                                : num  61 68 76 76 77 78 82 88 97 79 ...
#>  $ fore_wind_speed_avg10m                                       : num  7.4 7.3 7.1 7 6.7 6.5 6.4 6.2 5.9 5.5 ...
#>  $ fore_wind_speed_relative                                     : num  5.5 5.8 5.9 5.6 5.7 5.3 5 4.3 3.6 3.8 ...
#>  $ fore_wind_speed_true                                         : num  6.6 6.3 6.1 5.6 5.8 5.5 5.4 4.5 3.4 4.4 ...
#>  $ fore_wind_speed_true_gust10m                                 : num  8.9 8.9 8.9 8.9 8.8 8.8 8.8 8.8 8.6 7.5 ...
#>  $ fore_2_wind_direction_avg10m                                 : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_from_direction_relative                          : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_from_direction_true                              : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_speed_avg10m                                     : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_speed_relative                                   : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_speed_true                                       : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ fore_2_wind_speed_true_gust10m                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ port_air_temperature                                         : num  15.9 15.8 15.8 15.7 15.7 15.8 15.8 15.8 15.8 15.7 ...
#>  $ port_dew_point_temperature                                   : num  8.6 8.7 8.6 8.5 8.6 8.6 8.6 8.6 8.6 8.6 ...
#>  $ port_longwave_irradiance                                     : num  354 349 345 343 343 343 345 346 345 345 ...
#>  $ port_photosynthetically_active_radiation                     : num  1759 1585 1229 1373 1569 ...
#>  $ port_relative_humidity                                       : num  62 63 63 63 63 63 62 62 63 63 ...
#>  $ port_solar_irradiance                                        : num  834 780 617 675 751 611 615 573 464 450 ...
#>  $ port_uvb_radiation                                           : num  2.24 2.1 1.85 1.93 2.04 ...
#>  $ port_uv_irradiance                                           : num  39 36 30 33 36 32 30 29 26 25 ...
#>  $ stbd_air_temperature                                         : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_dew_point_temperature                                   : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_photosynthetically_active_radiation                     : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_relative_humidity                                       : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_solar_irradiance                                        : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_uvb_radiation                                           : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_uv_irradiance                                           : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ stbd_longwave_irradiance                                     : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ precipitation_accumulation_1h                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ precipitation_rate                                           : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ present_weather                                              : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ present_weather_15m                                          : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ snow_accumulation_1m                                         : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ visibility_in_air                                            : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ visibility_in_air_10m                                        : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_cover_1                                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_cover_2                                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_cover_3                                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_cover_4                                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_cover_5                                                : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_height_1                                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_height_2                                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_height_3                                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_height_4                                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ cloud_height_5                                               : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ sea_water_temperature                                        : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ sea_water_salinity                                           : num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#>  $ mole_concentration_of_dissolved_molecular_oxygen_in_sea_water: num  NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...
#> NULL
```

``` r
dat <- tibble::as_tibble(dat)
dat <- tail(dat, n)
dat$date_time_utc <- as.POSIXct(dat$date_time_utc, "%Y/%m/%d %H:%M:%S", tz = "UTC")

track <- cbind(dat$longitude, dat$latitude)

track <- terra::project(as.matrix(track), to = terra::crs(r), from = "OGC:CRS84")
lines(track, col = "hotpink")
pt <- tail(track[!is.na(track[,1]) & !is.na(track[,2]), ], 1L)
points(pt, pch = "+", col = "hotpink")
bx <- c(range(track[,1], na.rm = TRUE), range(track[,2], na.rm = TRUE))
rect(bx[1], bx[3], bx[2], bx[4])

CGAZ <- "/vsizip//vsicurl/https://github.com/wmgeolab/geoBoundaries/raw/main/releaseData/CGAZ/geoBoundariesCGAZ_ADM0.zip"
CGAZ_sql <- "SELECT shapeGroup FROM geoBoundariesCGAZ_ADM0 WHERE shapeGroup IN ('AUS','NZL','ATA')"
map <- terra::vect(CGAZ, query = CGAZ_sql)
plot(track, type = "n", asp = 1)
title(paste0(as.Date(range(dat$date_time_utc)),collapse = ","), col.main = "white")
plotRGB(r, add = TRUE)
lines(track, col = "hotpink")
#lines(terra::project(do.call(cbind, maps::map(plot = F)[1:2]), to = terra::crs(r), from = "OGC:CRS84"), lwd = 1.5, col = "#777777")
plot(terra::project(map, terra::crs(r)), add = TRUE, border = "#777777")


par(mfrow = c(5, 1))
plot(dat$date_time_utc, dat$port_solar_irradiance, pch = 19, cex = .2)
plot(dat$date_time_utc, dat$shipnav_ground_course, pch = 19, cex = .2)
plot(dat$date_time_utc, dat$air_pressure_tend3h, pch = 19, cex = .2)
plot(dat$date_time_utc, dat$fore_2_wind_from_direction_true, pch = 19, cex = .2)
plot(dat$date_time_utc, dat$port_air_temperature, pch = 19, cex = .2)
```

This is 25km sea ice concentration from NSIDC, reprojected from images
published by NOAA at <https://noaadata.apps.nsidc.org/NOAA/G02135/> (the
projection is Transverse Mercator with central longitude 147).

The point (and track if available) is the recent position of the [Nuyina
research vessel](https://www.antarctica.gov.au/nuyina/) taken from the
underway data that measures atmospheric and water properties.

Files in ‘data-raw/’ contain the actual metadata and scripts. This runs
as a daily task on github actions.

## Code of Conduct

Please note that the seaice.map project is released with a [Contributor
Code of
Conduct](https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.
